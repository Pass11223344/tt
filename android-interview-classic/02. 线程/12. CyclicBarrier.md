# CyclicBarrier

å¾ªç¯å±éšœï¼ˆCyclicè¯»ä½œèµ›å…‹ç«‹å…‹ï¼‰

## æ¦‚è¿°

CyclicBarrieræ˜¯ä¸€ç§çº¿ç¨‹åŒæ­¥å·¥å…·ï¼Œç”¨äºç­‰å¾…ä¸€ç»„çº¿ç¨‹åˆ°è¾¾åŒä¸€ä¸ªå±éšœç‚¹ï¼Œç„¶ååŒæ—¶æ‰§è¡Œã€‚


## å®ä¾‹è¯´æ˜


1. å°Aã€å°Bã€å°Cä¸‰äººçº¦å®šåœ¨å…¬å›­é—¨å£é›†åˆï¼Œå¹¶ä½¿ç”¨CyclicBarrieræ§åˆ¶æ‰€æœ‰äººä¸€èµ·å‡ºå‘ã€‚
2. ä»–ä»¬åˆ†åˆ«ä»ä¸åŒçš„åœ°ç‚¹å‡ºå‘å‰å¾€å…¬å›­ï¼Œåˆ°è¾¾åä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š
    - åˆ°è¾¾é—¨å£åï¼Œè°ƒç”¨await()æ–¹æ³•è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚
    - ç­‰å¾…å…¶ä»–äººåˆ°é½ã€‚å¦‚æœæœ‰äººæœªèƒ½æŒ‰æ—¶åˆ°é½ï¼Œåˆ™æ‰€æœ‰äººéƒ½å¿…é¡»åœ¨é—¨å£ç­‰å¾…ã€‚
    - å½“æ‰€æœ‰äººåˆ°é½åï¼Œæ‰§è¡ŒæŒ‡å®šçš„ä»»åŠ¡ï¼ˆå¦‚åˆå”±ä¸€é¦–æ­Œã€æ‹ç…§ç•™å¿µç­‰ï¼‰ã€‚
3. é—¨å£çš„å±éšœè§£é™¤ï¼Œå°Aã€å°Bã€å°Cä¸€èµ·è¿›å…¥å…¬å›­å¼€å§‹é‡é¤ã€‚

>æ³¨æ„ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼ŒCyclicBarrierä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªç±»ä¼¼äºCountDownLatchçš„å€’è®¡æ—¶å™¨ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¹‹å‰ï¼Œéœ€è¦å…ˆè¿›è¡Œé¢„çƒ­æˆ–è€…å‡†å¤‡å·¥ä½œï¼Œç„¶åå½“å€’è®¡æ—¶ç»“æŸæ—¶å†ä¸€èµ·æ‰§è¡ŒæŸä¸ªåŠ¨ä½œã€‚

### ä»£ç å®ç°

```java
import java.util.concurrent.BrokenBarrierException;
import java.util.concurrent.CyclicBarrier;

public class PicnicDemo {
    private static final int PERSON_COUNT = 3;
    private static final CyclicBarrier BARRIER = new CyclicBarrier(PERSON_COUNT, () -> {
        System.out.println("æ‰€æœ‰äººéƒ½åˆ°é½äº†ï¼Œå¯ä»¥å¼€å§‹é‡é¤å•¦ï¼");
    });

    public static void main(String[] args) {
        for (int i = 0; i < PERSON_COUNT; i++) {
            // åˆ›å»ºçº¿ç¨‹ï¼Œè¡¨ç¤ºæ¯ä¸ªäººåˆ°å…¬å›­çš„è·¯ç¨‹
            Thread t = new Thread(() -> {
                try {
                    System.out.println(Thread.currentThread().getName() + " å·²ç»åˆ°è¾¾é—¨å£ã€‚");
                    BARRIER.await(); // ç­‰å¾…å…¶ä»–äººåˆ°é½
                    System.out.println(Thread.currentThread().getName() + " å¸®å¿™åšå¥½å‡†å¤‡å·¥ä½œã€‚");
                    // ğŸ””awaitæ–¹æ³•å¯ä»¥å¤šæ¬¡ä½¿ç”¨ï¼Œè€ŒCDLåˆ™ä¸è¡Œ
                    BARRIER.await(); // ç­‰å¾…æ‰€æœ‰äººå‡†å¤‡å¥½
                    System.out.println(Thread.currentThread().getName() + " å¼€å§‹é‡é¤ã€‚");
                } catch (InterruptedException | BrokenBarrierException e) {
                    e.printStackTrace();
                }
            }, "å°" + (char)('A' + i));
            t.start();
        }
    }
}

```

### è¾“å‡ºå†…å®¹
```java
å°A å·²ç»åˆ°è¾¾é—¨å£ã€‚
å°C å·²ç»åˆ°è¾¾é—¨å£ã€‚
å°B å·²ç»åˆ°è¾¾é—¨å£ã€‚
æ‰€æœ‰äººéƒ½åˆ°é½äº†ï¼Œå¯ä»¥å¼€å§‹é‡é¤å•¦ï¼
å°C å¸®å¿™åšå¥½å‡†å¤‡å·¥ä½œã€‚
å°B å¸®å¿™åšå¥½å‡†å¤‡å·¥ä½œã€‚
å°A å¸®å¿™åšå¥½å‡†å¤‡å·¥ä½œã€‚
æ‰€æœ‰äººéƒ½åˆ°é½äº†ï¼Œå¯ä»¥å¼€å§‹é‡é¤å•¦ï¼
å°A å¼€å§‹é‡é¤ã€‚
å°C å¼€å§‹é‡é¤ã€‚
å°B å¼€å§‹é‡é¤ã€‚
```








