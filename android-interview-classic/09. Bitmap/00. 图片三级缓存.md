# 图片三级缓存

## 概述

Android图片三级缓存是一种优化图片加载的策略，由内存缓存、磁盘缓存和网络缓存组成。

1. 内存缓存使用LruCache等数据结构，在内存中缓存最常使用的图片；
2. 磁盘缓存将图片保存在本地存储中，以加快后续加载速度；
3. 网络缓存则使用HTTP协议的缓存机制，在网络请求中缓存图片数据。

这三级缓存结合使用，可提升图片加载性能和用户体验。

## 详述

在 Android 开发中，为了提升图片加载的性能和用户体验，常常会使用一种被称为“图片三级缓存”（也叫做“图片三缓”）的技术。这种机制的核心思想在于通过不同层级的缓存，减少网络请求的次数以及减轻 CPU 和内存的负担，具体包括：

### 1. **内存缓存（Memory Cache）**
- **目的**：加快图片的读取速度。
- **工作原理**：将经常访问的图片数据存储在内存中，当需要显示图片时，首先在内存中查找是否有缓存的图片数据，从而避免了磁盘的 I/O 访问或者网络请求。
- **工具**：可以使用 `LruCache` 类来实现内存缓存。`LruCache` 使用 LRU（最近最少使用）算法来管理缓存的条目。
  
### 2. **本地缓存（Disk Cache 或 Local Cache）**
- **目的**：减少对网络的依赖，减少不必要的网络请求。
- **工作原理**：如果内存中没有缓存的图片数据，那么就在磁盘中查找。如果磁盘中有缓存的图片，就直接使用磁盘中的数据。如果磁盘中没有，则发起网络请求获取图片。
- **工具**：可以使用 `DiskLruCache` 类来实现本地缓存。

### 3. **网络缓存（Network Cache）**
- **目的**：提供一种当内存和磁盘中都没有缓存数据时，从网络获取数据的手段。
- **工作原理**：如果在内存和磁盘中都没有找到缓存的数据，就从网络请求数据。获取到数据后，通常会存储到磁盘和内存中以便后续的使用。

### 工作流程
下面简单描述一下这个三级缓存机制的工作流程：

1. **请求图片**：当需要加载并显示一个图片时。
   
2. **查找内存缓存**：
   - 如果内存缓存有数据，直接使用这些数据显示图片。
   - 如果内存缓存没有数据，进入下一级 —— 本地缓存。
   
3. **查找本地缓存**：
   - 如果本地缓存有数据，加载本地数据到内存缓存并显示图片。
   - 如果本地缓存没有数据，进入下一级 —— 网络缓存。
   
4. **从网络获取数据**：
   - 请求网络数据。
   - 将获取到的数据存储到本地缓存和内存缓存中。
   - 显示图片。

这种分层次的缓存机制能够显著提升图片加载的性能，同时减轻服务器的负担。在实现时可以使用现有的图片加载库（如 Glide、Picasso 等），这些库通常内置了这种三级缓存机制，同时也提供了很多其他实用的特性和优化。