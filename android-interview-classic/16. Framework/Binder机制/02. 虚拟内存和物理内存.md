# 虚拟内存和物理内存

## 概述

虚拟内存是操作系统提供的一种机制，将硬盘空间用作扩展内存的一部分。它通过将内存中暂时不需要的数据存储到硬盘上，以释放物理内存，并在需要时将数据重新加载到物理内存中。

物理内存是计算机中实际存在的内存硬件，用于存储正在执行的程序和数据。虚拟内存可以扩展物理内存的容量，提供更大的内存空间给应用程序运行，提高系统的性能和效率。

<blockquote>
假设一台设备，它的物理内存是4G。

1. 一个进程运行时，会得到4G的虚拟内存。
2. 4G虚拟内存是一个连续的内存空间，但实际上对应着一段段非连续的物理内存碎片。

> 虚拟内存和物理内存的关系就像是地球仪和🌏的关系。
>
> 每个进程运行时都会得到一个地球仪，但真实的空间由真实的🌏决定。
</blockquote>

## 详述

虚拟内存和物理内存是计算机存储管理中两个核心的概念。它们都是内存管理策略的一部分，通过协同工作，支持操作系统和应用程序的执行。下面简要解释一下它们的定义和如何工作。

### 物理内存（Physical Memory）

物理内存通常指的是计算机硬件提供的实际可用存储空间，它是由 RAM（Random Access Memory）模块提供的。物理内存的大小是有限的，由实际安装的 RAM 模块决定。

- **特点**：
  - 有限的存储容量。
  - 当电源关闭时，存储的数据会丢失。
  - 提供快速的数据读写。
  
- **用途**：
  - 存储运行中的操作系统的数据。
  - 存储和运行应用程序的代码和数据。
  
### 虚拟内存（Virtual Memory）

虚拟内存是一个存储管理技术，它使应用程序“认为”它们有比实际物理内存更多的可用内存。虚拟内存通常使用硬盘上的一部分空间作为内存使用（称为交换区或分页文件），在物理内存不足时，使用硬盘空间来暂存部分数据。

- **特点**：
  - 空间大，由硬盘大小决定。
  - 访问速度较慢，远不如物理内存。
  
- **用途**：
  - 提供额外的内存空间，使得应用程序可以运行在一个更大的内存空间中。
  - 在物理内存不足时，暂存部分数据，以便在需要时将其调回物理内存中。
  
### 虚拟内存和物理内存协同工作

1. **地址映射**：
   - 操作系统为每一个运行的进程维护一个虚拟地址空间。
   - 通过地址映射表（例如，页表）的帮助，将虚拟地址映射到物理内存地址。

2. **分页和换页**：
   - 当一个进程访问的数据不在物理内存中（发生页错误）时，操作系统会选择一个物理内存页面将其换出到磁盘的交换区。
   - 同时，操作系统将需要的数据从磁盘换入到物理内存，并更新地址映射表。
   
3. **内存管理**：
   - 操作系统使用一系列算法（如最近最少使用（LRU）算法）来决定在物理内存不足时，哪些数据页应该被换出到磁盘。
   - 通过合理的内存管理策略，虚拟内存系统可以确保最常用的数据页尽可能地保留在物理内存中。

总之，虚拟内存和物理内存的协同工作，使得计算机能够更加高效地运行多个应用程序，尽可能减少因物理内存不足而导致的系统性能下降。虚拟内存技术允许应用程序使用一个比实际物理内存大得多的地址空间，使得它们能够在物理内存受限的情况下运行。